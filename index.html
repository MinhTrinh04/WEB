<!DOCTYPE html>
<html>
  <head>
    <title>React CRUD - Step 4</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
      table {
        border-collapse: collapse;
        width: 100%;
      }
      th,
      td {
        border: 1px solid #ddd;
        padding: 8px;
      }
      th {
        background-color: #f2f2f2;
      }
    </style>
  </head>
  <body>
    <div id="root"></div>

    <script type="text/babel">
      function SearchForm({ onChangeValue }) {
        return (
          <input
            type="text"
            placeholder="Tìm theo name, username"
            onChange={(e) => onChangeValue(e.target.value)}
          />
        );
      }

      function AddUser({ onAdd }) {
        return (
          <div>
            <i>(Đây là AddUser)</i>
            <hr />
          </div>
        );
      }

      function ResultTable({ keyword, user, onAdded }) {
        const [users, setUsers] = React.useState([]);
        const [loading, setLoading] = React.useState(true);

        React.useEffect(() => {
          fetch("https://jsonplaceholder.typicode.com/users")
            .then((res) => res.json())
            .then((data) => {
              setUsers(data);
              setLoading(false);
            });
        }, []);

        const filteredUsers = users.filter(
          (u) =>
            u.name.toLowerCase().includes(keyword.toLowerCase()) ||
            u.username.toLowerCase().includes(keyword.toLowerCase())
        );

        if (loading) {
          return <p>Loading...</p>;
        }

        return (
          <table>
            <thead>
              <tr>
                <th>ID</th>
                <th>Name</th>
                <th>Username</th>
                <th>Email</th>
                <th>City</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              {filteredUsers.map((u) => (
                <tr key={u.id}>
                  <td>{u.id}</td>
                  <td>{u.name}</td>
                  <td>{u.username}</td>
                  <td>{u.email}</td>
                  <td>{u.address.city}</td>
                  <td>
                    <button onClick={() => alert("Chưa làm")}>Sửa</button>
                    <button onClick={() => alert("Chưa làm")}>Xóa</button>
                  </td>
                </tr>
              ))}
            </tbody>
          </table>
        );
      }

      function App() {
        const [kw, setKeyword] = React.useState("");
        const [newUser, setNewUser] = React.useState(null);

        return (
          <div>
            <h1>Quản lý người dùng</h1>
            <SearchForm onChangeValue={setKeyword} />
            <AddUser onAdd={setNewUser} />
            <ResultTable
              keyword={kw}
              user={newUser}
              onAdded={() => setNewUser(null)}
            />
          </div>
        );
      }

      const root = ReactDOM.createRoot(document.getElementById("root"));
      root.render(<App />);
    </script>
  </body>
</html>
